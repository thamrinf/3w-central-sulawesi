<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>4W Sulawesi Earthquake and Tsunami</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">

    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>

  </head>

  <body>


  	<!-- HEADER -->
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
      <h5 class="my-0 mr-md-auto font-weight-normal">3W Central Sulawesi Earthquake and Tsunami 2018</h5>
      <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" href="#">About</a>
      </nav>
    </div>
    <!-- END HEADER -->


    <!-- START Page Content -->
    <div class="container-fluid" id='maincontainer'>
    	<div class="row">
        	<!-- CENTER PANEL -->
        	<div class="col-12">
    			<div class="col-md-12 apanel">
	    			<div class="row">
	    				<div class="col-md-12" style="text-align: left;">
	    					<p class="pmap">The visualisation shows number of agencies and sectors activities on Central Sulawesi Earthquake and Tsunami. The data was based on the report that was received by OCHA and AHA Centre from the lead sectors agencies. The Visualisation only shows activities on Sub District level.<br>
	    					The Visualisation was done based on a collaboration work by OCHA, AHA Centre, HDX and Pulse Lab Jakarta.
	    					</p>
	    					<center>
	    						<select class="form-control" id="regionselect">
	    							<option value='0'>All SUB DISTRICT</option>
	    							<!-- generated by f_getRegionSelect() -->
	    						</select>

	    					</center>
	    				</div>
	    				<div class="col-4 blockmaptop">
	    					<font class="blockmaptop_title">
		    					<i class="" aria-hidden="true"></i>&nbsp;
		    					Organisations
		    				</font>
	    					<h4 id='val1'>
	    						<!-- generated by f_getBlockInfo() -->
	    					</h4>
	    				</div>
	    				<div class="col-4 blockmaptop">
		    				<font class="blockmaptop_title">
		    					<i class="" aria-hidden="true"></i>&nbsp;
		    					Activities
		    				</font>
		    				<h4 id='val2'>
		    					<!-- generated by f_getBlockInfo() -->
		    				</h4>
		    			</div>
	    				<div class="col-4 blockmaptop" style="border-right:0px">
	    					<font class="blockmaptop_title">
	    						<i class="" aria-hidden="true"></i>&nbsp;
	    						Location
	    					</font>
	    					<h4 id='val3'>
	    						<!-- generated by f_getBlockInfo() -->
	    					</h4>
	    				</div>
	    			</div>
	    		</div>
	    		<div class="col-md-12 apanel">
	    			<div class="row">
	    				<div class="col-md-6">
	    					<div id='regions_div'></div>
	    				</div>
	    				<div class="col-md-6">
	    					<div class="row">
	    						<div class="col-md-6">
				    				<div class="col-md-12 paneltitle">
					    				<font class="panelTitleLight">Type of &nbsp;</font><font class="panelTitleBold">Organizations</font>
					    			</div>
					    			<div id="pieOrg"></div>
					    		</div>
					    		<div class="col-md-6">
				    				<div class="col-md-12 paneltitle">
					    				<font class="panelTitleLight">Activity &nbsp;</font><font class="panelTitleBold">Status</font>
					    			</div>
					    			<div id="pieStat"></div>
					    		</div>
					    		<div class="col-md-12" style="margin-top: 3rem">
				    				<div class="col-md-12 paneltitle">
					    				<font class="panelTitleLight">Type of &nbsp;</font><font class="panelTitleBold">Sector</font>
					    			</div>
					    			<div id="barSect"></div>
					    		</div>
	    					</div>
	    				</div>
	    				
	    			</div>
	    				
	    		</div>
	    	</div>
    		
    		<div class="col-md-12 hidewhenmobile order-md-4" style="margin-top: 2rem">
    			<left>
	    			<p>The Visualisation is based on the latest compilation report by OCHA and AHA Centre, and the listed activities are only taken from the report that includes minimum information that can be mapped.
					</p>
				</center>
	    		<div class="col-md-12 apanel" style="margin-top: 10px;">
	    			<div class="row">
		    			<div class="col-md-12">
		    				<table id="datatable" class="table table-striped table-bordered table-hover"></table>
		    			</div>
		    		</div>
	    		</div>
	    	</div>

    	</div>
    </div>
    <!-- END Page Content -->
    <br/><br/>


    <!-- JAVASCRIPT LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script>

    <script type="text/javascript">
    	$(document).ready(function(){

    		// INITIAL VARIABLE
    		var thedata,
    			theDataTableInit = 0,
    			human_number = d3.format(",d"),
    			SelectedRegion = 'Sub Dstrict',
    			statesData = 0,
    			locationCount = [],
    			organisationCount = [],
    			statusCount = [],
    			sectorCount = [],
    			orgtotal = 0,
    			zero = 0;


			var geojson;
			var map = L.map('regions_div').setView([-0.8303039110366366, 120.26079355689537], 9);
			var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 15,
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			});
			OpenStreetMap_Mapnik.addTo(map);




    		// function to draw the map
    		function drawregiondiv(){
    			
    			// control that shows state info on hover
				var info = L.control();

				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info');
					this.update();
					return this._div;
				};

				info.update = function (props) {
					
					this._div.innerHTML = '<h5>Organisation Activities by Sub District</h5>' +  (props ?
						'<b>' + props.KECAMATAN + '</b><br />' + locationCount[props.KECAMATAN] + ' Activities'
						: 'Hover over a state');
				};

				info.addTo(map);


				// get color depending on population density value
				function getColor(d) {
					return 	d > 50  ? '#E31A1C' :
							d > 20  ? '#FC4E2A' :
							d > 10  ? '#FD8D3C' :
							d > 5   ? '#FEB24C' :
							d > 1   ? '#FED976' :
										'transparent';
				}

				function style(feature) {
					return {
						weight: 1,
						opacity: 1,
						color: 'white',
						dashArray: '3',
						fillOpacity: 0.5,
						fillColor: getColor(locationCount[feature.properties.KECAMATAN]) 
					};
				}

				function highlightFeature(e) {
					var layer = e.target;

					layer.setStyle({
						weight: 5,
						color: '#666',
						dashArray: '',
						fillOpacity: 0.7
					});

					if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
						layer.bringToFront();
					}

					info.update(layer.feature.properties);
				}


				function resetHighlight(e) {
					geojson.resetStyle(e.target);
					info.update();
				}

				function zoomToFeature(e) {
					// map.fitBounds(e.target.getBounds());
					let kec = e.target.feature.properties.KECAMATAN;
					let select = kec.replace(' ','-');
					$('#regionselect option').removeAttr('selected').filter('[value=' + select + ']').attr('selected', true);
					redrawvis(kec);
				}

				function onEachFeature(feature, layer) {
					layer.on({
						mouseover: highlightFeature,
						mouseout: resetHighlight,
						click: zoomToFeature
					});
				}

				geojson = L.geoJson(statesData, {
					style: style,
					onEachFeature: onEachFeature
				}).addTo(map);

				map.attributionControl.addAttribution('3W Data &copy; Compile by OCHA and AHA Centre');


				var legend = L.control({position: 'bottomright'});

				legend.onAdd = function (map) {

					var div = L.DomUtil.create('div', 'info legend'),
						grades = [1, 5, 10, 20, 50],
						labels = [],
						from, to;

					for (var i = 0; i < grades.length; i++) {
						from = grades[i];
						to = grades[i + 1];

						labels.push(
							'<i style="background:' + getColor(from + 1) + '"></i> ' +
							from + (to ? '&ndash;' + to : '+'));
					}

					div.innerHTML = labels.join('<br>');
					return div;
				};

				legend.addTo(map);
	    	}

	    	function f_drawPieOrg(){
	    		var thedata = [['Type Org', 'Total']];
	    		for(x in organisationCount){
	    			thedata.push([x,organisationCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
				  	legend: 'none',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#003E15', '#037D45', '#64A877', '#BAD7BD', '#EBF5EC'],
			        chartArea:{
			        	left:0,
			        	top:10,
			        	bottom:10,
			        	width:'100%',
			        	height:'100%'
			        }
			      };

				  // Display the chart inside the <div> element with id="piechart"
				  var chart = new google.visualization.PieChart(document.getElementById('pieOrg'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbaseorg(thedata[sel+1][0]);
				  });
				}
	    	}
				
			function f_drawPieStat(){
	    		var thedata = [['Status', 'Total']];
	    		for(x in statusCount){
	    			thedata.push([x,statusCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
				  	legend: 'none',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#037D45', '#64A877', '#BAD7BD'],
			        chartArea:{
			        	left:0,
			        	top:10,
			        	bottom:10,
			        	width:'100%',
			        	height:'100%'
			        },
			      };

				  // Display the chart inside the <div> element with id="piechart"
				  var chart = new google.visualization.PieChart(document.getElementById('pieStat'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbasestat(thedata[sel+1][0]);
				  });
				}
	    	}		

	    	function f_drawBarSect(){
	    		var thedata = [['Sector', 'Total',{type: 'string', role: 'annotation'}]];
	    		for(x in sectorCount){
	    			thedata.push([x,sectorCount[x],sectorCount[x]])
	    		}
	    		google.charts.load('current', {packages: ['corechart', 'bar']});
				google.charts.setOnLoadCallback(drawBasic);

				function drawBasic() {

				      var data = google.visualization.arrayToDataTable(thedata);

				      var options = {
				      	colors:['#B2DF72'],
				      	height:350,
				        chartArea: {width: '80%',top:5,right:0,bottom:40},
				        legend: 'none',
				        
				        //hAxis: {
				          //title: 'Total',
				          //minValue: 0
				        //},
				        //vAxis: {
				          //title: 'Sectors'
				       // },
				        annotations: {
				          alwaysOutside: true,
				          textStyle: {
				            fontSize: 12,
				            auraColor: 'none',
				            color: '#555'
				          },
				          boxStyle: {
				            stroke: '#ccc',
				            strokeWidth: 1,
				            gradient: {
				              color1: '#f3e5f5',
				              color2: '#f3e5f5',
				              x1: '0%', y1: '0%',
				              x2: '100%', y2: '100%'
				            }
				          }
				        },
				        animation:{
					        duration: 1000,
					        easing: 'out',
					        startup: true
					    },
				      };

				      var chart = new google.visualization.BarChart(document.getElementById('barSect'));

				      chart.draw(data, options);
				      google.visualization.events.addListener(chart, 'select', function() {
						  var sel = chart.getSelection()[0].row;
						  redrawbasesector(thedata[sel+1][0]);
					  });
				    }
	    	}	


	    	// function to draw the data table
	    	function f_drawDataTable(data){
	    		if(theDataTableInit){
	    			theDataTableInit.destroy();
	    		}

	    		var thedatasource = [];
	    		$.each(data,function(i,z){

	    			newdata = [	z['Implementing Agency'],
	    						z['Sector/Cluster'],
	    						z['Activity Category'],
	    						z['Org Type'],
	    						z['District'],
	    						z['Sub Dstrict'],
	    						z['Village'],
	    						// z['Place Name'],
	    						z['Activity'],
	    						// z['Materials/Service Provided'],
	    						//z['Primary Beneficiary'],
	    						// z['# of Primary Beneficiaries'],
	    						z['Status'],
	    						z['Start Date'],
	    						z['End Date'],
	    					];
	    			
    				thedatasource.push(newdata);
    			});

    			// console.log(thedatasource);

	    		theDataTableInit = $('#datatable').DataTable( {
	    			data: thedatasource,
			        columns: [
			            { title: "Implementing Agency" },
			            { title: "Sector/Cluster" },
			            { title: "Activity Category" },
			            { title: "Org Type" },
			            { title: "District" },
			            { title: "Sub Dstrict" },
			            { title: "Village" },
			            // { title: "Place Name" },
			            { title: "Activity" },
			            // { title: "Materials/Service Provided" },
			            // { title: "Primary Beneficiary" },
			            // { title: "# of Primary Beneficiaries" },
			            { title: "Status" },
			            { title: "Start Date" },
			            { title: "End Date" },
			            
			        ],
			        responsive: true,
			        
				    
			    } );
	    	}

	    	$('#regionselect').on('change',function(){
	    		var val = $(this).val();
	    		let select = val.replace('-',' ');
	    		if(val == 0){
	    			redrawvis(val);

	    		}else{
	    			redrawvis(select);

	    		}
	    	})

	    	function redrawvis(namakecamatan){
	    		console.log(namakecamatan);
	    		map.removeLayer(geojson);
	    		$('.info').remove();

    			organisationCount = [];
    			statusCount = [];
    			sectorCount = [];
    			locationCount=[];
    			datatblnew = [];
    			orgtotal=[];

	    		thedata.forEach(function(d){
	    			if(namakecamatan == '0'){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}
		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
	    			}
	    			else if(d['Sub Dstrict'].toUpperCase() == namakecamatan.toUpperCase()){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}
		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    		}
	    			
	    		})
	    		console.log(statusCount);

	    		drawregiondiv();
	    		f_drawPieOrg();
	    		f_drawPieStat();
	    		f_drawBarSect();
	    		f_drawDataTable(datatblnew);

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in locationCount){
	    			val3++;
	    			val2+=locationCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    	}

	    	function redrawbasestat(stat){
	    		map.removeLayer(geojson);
	    		$('.info').remove();
	    		
	    		organisationCount = [];
    			datatblnew = [];
    			locationCount = [];
    			orgtotal=[];
    			sectorCount=[];

	    		thedata.forEach(function(d){
	    			if(d['Status'].toUpperCase() == stat){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}
	    			}
	    		})

	    		drawregiondiv();
	    		f_drawPieOrg();
	    		f_drawDataTable(datatblnew);
	    		f_drawBarSect();

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in locationCount){
	    			val3++;
	    			val2+=locationCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    	}

	    	function redrawbaseorg(org){
	    		map.removeLayer(geojson);
	    		$('.info').remove();
	    		
    			datatblnew = [];
    			locationCount = [];
    			orgtotal=[];
    			sectorCount=[];
    			statusCount = [];

	    		thedata.forEach(function(d){
	    			if(d['Org Type'].toUpperCase() == org){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}
	    			}
	    		})

	    		drawregiondiv();
	    		f_drawDataTable(datatblnew);
	    		f_drawBarSect();
	    		f_drawPieStat();

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in locationCount){
	    			val3++;
	    			val2+=locationCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    	}

	    	function redrawbasesector(sector){
	    		map.removeLayer(geojson);
	    		$('.info').remove();
	    		
	    		organisationCount = [];
    			statusCount = [];
    			datatblnew = [];
    			locationCount = [];
    			orgtotal=[];

	    		thedata.forEach(function(d){
	    			if(d['Sector/Cluster'].toUpperCase() == sector){
	    				datatblnew.push(d);
	    				let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
	    			}
	    		})

	    		drawregiondiv();
	    		f_drawPieOrg();
	    		f_drawPieStat();
	    		f_drawDataTable(datatblnew);

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in locationCount){
	    			val3++;
	    			val2+=locationCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    	}

	    	function drawinit(){
	    		orgtotal=[];
	    		thedata.forEach(function(d){
		    			let tempat = d['Sub Dstrict'].toUpperCase();
		    			if(locationCount[tempat]){
		    				locationCount[tempat] += 1;
		    			}else{
		    				locationCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let orgtype = d['Org Type'].toUpperCase();
		    			if(organisationCount[orgtype]){
		    				organisationCount[orgtype] += 1;
		    			}else{
		    				organisationCount[orgtype] = 1;
		    			}

		    			let stattype = d['Status'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sector/Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}
		    			
		    			
		    			let org=d['Implementing Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    	});

	    			console.log(orgtotal);

		    		drawregiondiv();
		    		f_drawPieOrg();
		    		f_drawPieStat();
		    		f_drawBarSect();
		    		f_drawDataTable(thedata);

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in locationCount){
		    			val3++;
		    			val2+=locationCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    	}



		    d3.json('idn_admin03_central_sulawesi_bnpb.geojson',function(jso){
	    		statesData = jso;
	    		//call the original data
	    		d3.csv('thedata.csv',function(data){
		    		//set the data called to variable thedata
		    		// console.log(data);
		    		thedata = data;

		    		drawinit();

		    	})	    	


	    	})


    	})
    	
    </script>


  </body>

</html>
